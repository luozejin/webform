<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>地形适宜性分析</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css"
    integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
  <link href="libs/dist/openlayers/4.6.5/ol.css" rel="stylesheet" />
  <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css" />
  <link rel="stylesheet" href="css/mapul.css" />
  <link rel="stylesheet" href="css/form.css" />
  <link rel="stylesheet" href="css/form1.css" />
</head>

<body style="background: #1E1E1E">
  <div id="main">
    <div class="mapTop">
      <img src="img/logo.png" />
      <span class="topTitle">地形适宜性分析</span>
    </div>
    <div id="map" style="width: 100%;height:100%"></div>
    <div id="popup" class="ol-popup">
      <div id="popup-content"></div>
    </div>

    <!-- 按钮、表单 -->
    <button id="btn" class="btn btn-outline-dark">地形适宜性分析</button>

    <form action="" id="box" name="forms" method="">
      <div class="top">
        <span id="err">×</span>
      </div>
      <div class="mid">
        <div class="mid-1">
          <input type="text" class="mid-1-one" value="输入数据路径">
          <input type="text" name="path">
        </div>

        <div class="mid-1">
          <input type="text" class="mid-1-one" value="输入数据epsg">
          <input type="text" name="srcEpsgCode" value="-1" onfocus="if (value =='-1'){value =''}"
            onblur="if (value ==''){value='-1'}">
        </div>

        <p>坡度因子</p>
        <div class="mid-2">
          <input type="text" class="mid-1-two" value="最适宜范围" name="3acf9dff_21fc62">
          <input type="text" name="3acf9dff_21fc62minValue" class="mu" value="3" onfocus="if (value =='3'){value =''}"
            onblur="if (value ==''){value='3'}">
          <input type="text" name="1" id="line" value="&macr;">
          <input type="text" name="3acf9dff_21fc62maxValue" class="mo" value="24.99"
            onfocus="if (value =='24.99'){value =''}" onblur="if (value ==''){value='24.99'}">
        </div>

        <div class="mid-2">
          <input type="text" class="mid-1-two" value="次适宜范围" name="7ed2550e_faea9c">
          <input type="text" name="7ed2550e_faea9cminValue" class="mu" value="30" onfocus="if (value =='30'){value =''}"
            onblur="if (value ==''){value='30'}">
          <input type="text" name="1" id="line" value="&macr;">
          <input type="text" name="7ed2550e_faea9cmaxValue" class="mo" value="45" onfocus="if (value =='45'){value =''}"
            onblur="if (value ==''){value='45'}">
        </div>

        <div class="mid-2">
          <input type="text" class="mid-1-two" value="zFactor">
          <input type="text" name="zFactor" value="30.000117" onfocus="if (value =='30.000117'){value =''}"
            onblur="if (value ==''){value='30.000117'}">
        </div>

        <p>坡向因子</p>
        <div class="mid-2">
          <input type="text" class="mid-1-two" value="适宜范围" name="8363b431_cf6b28">
          <input type="text" name="8363b431_cf6b28minValue" class="mu" value="60" onfocus="if (value =='60'){value =''}"
            onblur="if (value ==''){value='60'}">
          <input type="text" name="1" id="line" value="&macr;">
          <input type="text" name="8363b431_cf6b28maxValue" class="mo" value="200"
            onfocus="if (value =='200'){value =''}" onblur="if (value ==''){value='200'}">
        </div>

        <p>高程因子</p>
        <div class="mid-2">
          <input type="text" class="mid-1-two" value="最适宜范围" name="eab4bc3f_edac3">
          <input type="text" name="eab4bc3f_edac3minValue" class="mu" value="5" onfocus="if (value =='5'){value =''}"
            onblur="if (value ==''){value='5'}">
          <input type="text" name="1" id="line" value="&macr;">
          <input type="text" name="eab4bc3f_edac3maxValue" class="mo" value="99.99"
            onfocus="if (value =='99.99'){value =''}" onblur="if (value ==''){value='99.99'}">
        </div>

        <div class="mid-2">
          <input type="text" class="mid-1-two" value="次适宜范围" name="399cf225_a8ba6e">
          <input type="text" name="399cf225_a8ba6eminValue" class="mu" value="100"
            onfocus="if (value =='100'){value =''}" onblur="if (value ==''){value='100'}">
          <input type="text" name="1" id="line" value="&macr;">
          <input type="text" name="399cf225_a8ba6emaxValue" class="mo" value="400"
            onfocus="if (value =='400'){value =''}" onblur="if (value ==''){value='400'}">
        </div>

        <div class="mid-1">
          <span class="mid-1-one">结果保存路径</span>
          <input type="text" name="结果保存路径">
        </div>
        <div class="mid-1">
          <span class="mid-1-one">结果数据集名</span>
          <input type="text" name="结果数据集名">
        </div>
      </div>
      <input type="button" name="" value="提交" id="bit" class="btn btn-outline-info">
    </form>
  </div>

  <script>
    var Box = document.getElementById('box');
    var Btn = document.getElementById('btn');
    var Err = document.getElementById('err');
    // console.log(Box,Btn,Err);

    Btn.onclick = function () {
      Box.style.display = "block";
    }

    Err.onclick = function () {
      Box.style.display = "none";
    }
  </script>

  <script type="text/javascript" src="js/jquery.min.js"></script>
  <script src="ajax.js"></script>

  <script type="text/javascript">
    /* function fun1() {
      $(document).ready(function(){
        $("#bit").click(function(){ 
          x = $("form").serializeArray();
          // console.log(typeof(x)); // object

          var x = JSON.stringify(x); 
          // console.log(typeof(x)); // string
          // console.log(x);
          document.write(x);
        });
      });
    }
    fun1() */

    $('#bit').click(function () {
      var formData = $('#box').serializeArray();
      var jsonObj = {};
      for (var i in formData) {
        jsonObj[formData[i].name] = formData[i].value;
      }
      console.log(jsonObj); // object 表单json

      var ajax = new Ajax();
      ajax.get('./one.json', { path: {} }, function (data) {
        // console.log(data); // string

        var Adata = JSON.parse(data); // 外部json
        // console.log(Adata);// object

        Adata.path = jsonObj.path; // 地址
        Adata.srcEpsgCode = jsonObj.srcEpsgCode; // 输入数据epsg
        Adata["processes"]["3acf9dff_21fc62"]["minValue"] = jsonObj["3acf9dff_21fc62minValue"]; // 坡度因子
        Adata["processes"]["3acf9dff_21fc62"]["maxValue"] = jsonObj["3acf9dff_21fc62maxValue"];
        Adata["processes"]["7ed2550e_faea9c"]["minValue"] = jsonObj["7ed2550e_faea9cminValue"];
        Adata["processes"]["7ed2550e_faea9c"]["maxValue"] = jsonObj["7ed2550e_faea9cmaxValue"];
        Adata.zFactor = jsonObj.zFactor;
        Adata["processes"]["8363b431_cf6b28"]["minValue"] = jsonObj["8363b431_cf6b28minValue"]; //坡向因子
        Adata["processes"]["8363b431_cf6b28"]["maxValue"] = jsonObj["8363b431_cf6b28maxValue"];
        Adata.processes.eab4bc3f_edac3.minValue = jsonObj.eab4bc3f_edac3minValue; // 高程因子
        Adata.processes.eab4bc3f_edac3.maxValue = jsonObj.eab4bc3f_edac3maxValue;
        Adata["processes"]["399cf225_a8ba6e"]["minValue"] = jsonObj["399cf225_a8ba6eminValue"];
        Adata["processes"]["399cf225_a8ba6e"]["maxValue"] = jsonObj["399cf225_a8ba6emaxValue"];

        // console.log(Adata);
      })
    })


    /* $.ajax({
      url: 'http://127.0.0.1:5500/openlayers3Demo/index.html',
      date: {'json':JSON.stringify(json)},
      type: "get",
      success:function(res) {
        alert(res);
      },
      error:function() {
        alert("失败");
      }
    }); */

  </script>

  <script type="text/javascript" src="libs/dist/openlayers/4.6.5/ol.js"></script>
  <script type="text/javascript" src="libs/dist/openlayers/iclient9-openlayers.min.js"></script>
  <script type="text/javascript" src="js/jquery.min.js"></script>
  <script type="text/javascript" src="js/bootstrap.min.js"></script>
  <script type="text/javascript" src="./json_parse.js"></script>
  <script type="text/javascript" src="./toJSON.js"></script>
  <script type="text/javascript" src="./colorramps.js"></script>
  <script>
    var serverHost = "http://192.168.17.42:8099";

    var mapUrl =
      serverHost +
      "/iserver/services/map-catalog/rest/maps/DEM30_4326",
      dataUrl = serverHost + "/iserver/services/data-catalog/rest/data/",
      imageUrl =
        serverHost +
        "/iserver/services/map-catalog/rest/maps/DEM30_4326",
      demUrl =
        serverHost +
        "/iserver/services/map-catalog/rest/maps/DEM30_4326";

    var requestUrl =
      dataUrl + "datasources/catalog/datasets/DEM30_4326";
    var colorMapReq = {
      slope: {},
      dem: {}
    };
    var themeCacheMap = {
      slope: {},
      dem: {}
    };
    var themeLayer;

    var overlay = new ol.Overlay({
      element: document.getElementById("popup"),
      autoPan: true,
      autoPanAnimation: {
        duration: 250
      }
    });

    var url = "https://iserver.supermap.io/iserver/services/map-world/rest/maps/World";

    // 初始化地图信息
    var map = new ol.Map({
      target: 'map',
      controls: ol.control.defaults({ attributionOptions: { collapsed: false } })
        .extend([new ol.supermap.control.Logo()]),
      view: new ol.View({
        center: [0, 0],
        zoom: 3,
        projection: 'EPSG:4326'
      })
    });
    // 添加图层
    var layer = new ol.layer.Tile({
      source: new ol.source.TileSuperMapRest({
        url: url,
        wrapX: true
      }),
      projection: 'EPSG:4326'
    });
    map.addLayer(layer);

    // 比例尺控件
    scaleControl = new ol.control.ScaleLine();
    map.addControl(scaleControl);


      //初始化地图控件以及osm地图
    /* var map = new ol.Map({
      target: "map",
      controls: ol.control.defaults({
        attributionOptions: { collapsed: false }
      }),
      interactions: ol.interaction.defaults(),
      overlays: [overlay],
      view: new ol.View({
        center: [110.0, 30.0],
        zoom: 4,
        minZoom: 0,
        maxZoom: 12,
        projection: "EPSG:4326"
      })
    });

    // 影像图层
    var imageLayer = new ol.layer.Tile({
      title: "image",
      type: "base",
      source: new ol.source.TileSuperMapRest({
        url: imageUrl,
        wrapX: true
      }),
      projection: "EPSG:4326"
    });
    map.addLayer(imageLayer); */

  </script>
</body>

</html>